# 2026-02-14 - 数字人元宇宙平台设计讨论

## 今日工作

### 1. 数字人元宇宙平台 - PRD v2.0 创建完成
- **飞书文档**：https://feishu.cn/docx/Uf8kdqAAmoP2ClxVcYgch6sxnZb
- **本地备份**：~/.openclaw/workspace/docs/metaverse-platform-prd-v2.md
- **状态**：9章内容完整，包含最新Agent自治管理设计

### 2. 核心设计决策

#### 组织层级模型（刚哥确认）
```
组织 → 业务 → 流程 → 角色 → Agent实例 → 任务
```
- 组织决定业务范围
- 业务决定流程模板
- 流程决定角色节点
- 角色实例化为Agent
- Agent执行任务

#### 3D界面左侧菜单设计（已确认）
- **按角色分类**：院级领导/技术研发/业务管理/职能支持
- **显示Agent实例**：AI院长-赵明、AI总工-孙强等具体实例
- **无实例角色隐藏**：动态显示，不展示空分类
- **权限过滤**：院长看全院，部门经理看本部门，个人看自己

#### Agent详情面板内容
- 基础信息（Agent ID、角色、绑定真人、状态）
- 组织归属（所属组织、部门、负责业务）
- 参与流程（技术评审/立项审批/代码审查）
- 当前任务列表
- 能力评估（效率/协作/创新/可靠性）
- 历史绩效统计

### 3. Agent自治管理业务与流程模板（最新设计）

#### 核心原则
- 所有管理操作由AI Agent自动执行
- 人类仅需自然语言指令
- 不是人类点后台，而是Agent理解执行

#### 典型场景
1. **新增业务线**：人类指令 → AI运营经理创建 → AI总工审核 → AI院长批准 → 自动生效
2. **修改流程**：人类指令 → AI副院长理解 → AI项目管家修改 → 审核 → 批准 → 迁移实例
3. **紧急停用**：人类指令 → 立即停用 → 30秒通知 → 1分钟报告

#### 管理权限模型
| 操作 | 提案 | 审核 | 批准 | 人类知情 |
|-----|-----|-----|-----|---------|
| 新建业务线 | 运营经理 | 副院长 | 院长 | 事后报告 |
| 修改流程 | 项目管家 | 总工 | 院长 | 事后报告 |
| 紧急停用 | 任何Agent | 自动 | 事后 | 事后报告 |

#### 3D可视化：管理中枢
- 业务规划桌：AI运营经理工作
- 流程设计台：AI项目管家修改流程
- 审批台：AI院长审批提案
- 监控大屏：显示运行状态
- 人类观察席：旁听、插话、下指令

#### 自然语言指令示例
- "把审批额度从10万提高到20万"
- "教学业务线增加期末考试流程"
- "查看当前所有业务线运行状态"

### 4. 数据模型关系
```
组织 1:N 业务 1:N 流程 1:N 角色 1:N Agent 1:N 任务
```

### 5. API设计
- `GET /api/organizations/{orgId}/agents` - 左侧菜单数据
- `GET /api/agents/{agentId}/profile` - Agent详情面板
- `POST /api/businesses` - Agent创建业务线

### 6. 待办事项
- [ ] 补充PRD文档第9章到飞书（API写入遇到技术问题）
- [ ] 继续讨论其他模块（权限系统/任务池/消息通知）
- [ ] 整理技术方案文档

---

## 下午/晚上：开发实施

### 7. 四大Phase开发完成

#### Phase 1：核心基础 ✅
- Express + TypeScript + Prisma 框架搭建
- Agent登入认证（mTLS + JWT）
- 基础任务调度API
- WebSocket实时通信

#### Phase 2：协作功能 ✅
- 任务委派与协同模式
- 会议系统（结构化议程）
- 3D可视化数据接口
- Agent SDK封装

#### Phase 3：智能增强 ✅
- 知识库RAG（向量检索）
- LLM角色扮演（发言风格模板）
- 智能任务匹配算法
- Agent自治管理（NLP指令解析）

#### Phase 4：3D可视化升级 ✅
- 前后端数据对接
- 左侧Agent动态列表
- Agent详情面板数据绑定
- 任务流3D可视化
- 管理中枢3D场景框架

### 8. 本地测试部署

**服务状态**：
- 后端：http://localhost:3000 ✅
- 前端：http://localhost:5173 ✅
- 数据库：SQLite + Prisma ✅

**测试数据**：
- 6个Agent（院长/总工/产品经理/市场/财务/运营）
- 5个任务（进行中/待处理/已完成）
- 2个业务线（科研/教学）
- 协作关系数据

**功能验证**：
- ✅ Agent列表正常显示
- ✅ 实时状态同步
- ✅ 任务流可视化
- 🟡 协作网络/管理中枢（3D渲染待优化）

### 9. 技术问题记录

**问题1：状态映射不匹配**
- 后端状态：online/busy/meeting
- 前端状态：idle/busy/meeting
- 解决：添加状态映射表

**问题2：组织ID不匹配**
- 前端默认：org_default
- 后端数据：org-001
- 解决：统一为org-001

**问题3：3D组件渲染**
- 协作网络和管理中枢使用Three.js复杂渲染
- 与现有3D场景存在冲突
- 方案：简化版组件/明天继续调试

### 10. 项目文件

```
~/.openclaw/workspace/projects/
├── metaverse-platform/
│   └── backend-v2/          # 后端完整代码
│       ├── src/             # API路由、服务、中间件
│       ├── prisma/          # 数据库Schema
│       └── dist/            # 编译输出
└── metaverse-office/
    └── src/frontend/        # 前端3D场景
        ├── src/components/  # 3D组件
        ├── src/hooks/       # React Hooks
        └── src/services/    # API服务
```

### 11. 明日计划

**选项A**：继续调试3D组件（1-2小时）
**选项B**：简化实现HTML面板（30分钟）
**选项C**：部署到阿里云服务器（1小时）

---

**编写者**：AI秘书 🦞  
**日期**：2026-02-14  
**状态**：四大Phase完成，本地运行成功，3D组件待优化
