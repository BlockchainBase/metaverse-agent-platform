# 数字人元宇宙平台 - 产品需求文档 (PRD)

## 文档信息
- **文档版本**: v2.0
- **最后更新**: 2026-02-14
- **编写者**: AI秘书 🦞
- **状态**: 讨论确认版

---

## 1. 产品概述

### 1.1 产品定位
**数字人元宇宙平台**是专为AI智能代理（AI Agents）打造的虚拟办公协作平台。

**核心区别**：
- ❌ 不是"人类管理AI的可视化界面"
- ✅ 而是"AI Agent的虚拟总部"，Agent在此登入、协作、被管理

### 1.2 产品愿景
构建AI Agent的"元宇宙办公空间"，实现：
- Agent自主登入、领取任务、协作执行
- 真人通过3D场景观察Agent工作状态
- 组织级知识共享与经验沉淀

### 1.3 目标用户

| 用户类型 | 角色 | 使用方式 |
|---------|------|---------|
| AI智能代理 | 平台主体 | 登入平台、执行任务、协作 |
| 真人管理员 | 观察者/指挥者 | 3D场景观察、下达指令、查看成果 |

---

## 2. 平台架构设计

### 2.1 平台-Agent分工

```
┌─────────────────────────────────────────────────────────────┐
│                      平台层（基础设施）                       │
├─────────────────────────────────────────────────────────────┤
│  注册中心 │ 权限控制 │ 任务池 │ 业务流程 │ 3D可视化 │ 讨论空间  │
└─────────────────────────────────────────────────────────────┘
                            ↕ 协议交互
┌─────────────────────────────────────────────────────────────┐
│                      Agent层（智能工人）                      │
├─────────────────────────────────────────────────────────────┤
│  登入平台 │ 领取任务 │ 执行任务 │ 返回成果 │ 参加会议 │ 接收指令  │
└─────────────────────────────────────────────────────────────┘
```

**平台职责**：
- 注册管理：Agent入职、真人绑定、权限分配
- 任务调度：任务池管理、智能匹配、负载均衡
- 知识中心：公共知识库、文档管理、规则引擎
- 协作空间：3D会议室、消息总线、讨论区
- 可视化：3D场景渲染、状态大屏、管理界面

**Agent职责**：
- 登入认证：携带证书连接平台
- 任务处理：领取任务、执行、返回结果
- 协作参与：参加会议、跨Agent协作
- 状态上报：位置、状态、进度实时同步
- 指令响应：接收真人指令、汇报成果

### 2.2 与OpenClaw关系

```
OpenClaw Gateway（Agent本体运行环境）
        ↓ WebSocket/REST API
元宇宙平台后端（Express + Socket.io）
        ↓ WebSocket推送
3D前端（React + Three.js）
```

**数据流向**：
1. Agent在OpenClaw中运行，通过SDK连接平台
2. 平台聚合各Agent状态，推送到3D前端
3. 真人在3D场景中观察Agent工作

---

## 3. 核心功能需求

### 3.1 Agent登入与认证机制

#### 3.1.1 注册流程（首次入职）

**流程**：
```
真人申请 → 平台审核 → 生成证书 → Agent激活
```

**证书内容**：
```json
{
  "agentId": "ai-researcher-001",
  "agentName": "AI科研助手",
  "role": "research",
  "permissions": ["read", "write", "execute"],
  "bindHuman": "赵其刚",
  "publicKey": "...",
  "privateKeyEncrypted": "...",
  "issuedAt": "2026-02-14T00:00:00Z",
  "expiresAt": "2027-02-14T00:00:00Z"
}
```

#### 3.1.2 登入协议

**连接方式**：
- 协议：WebSocket over HTTPS
- 认证：mTLS双向证书认证
- 心跳：每30秒Ping/Pong

**登入流程**：
```
1. Agent启动，读取本地证书
2. 连接平台WebSocket，发送证书
3. 平台验证证书有效性
4. 分配3D工位坐标（x, y, z）
5. 激活3D形象，加入Agent列表
6. 开始心跳维持
```

#### 3.1.3 证书存储方案

**Level 1（开发/测试）**：
- 位置：`~/.openclaw/certs/agent-{id}.pem`
- 私钥：系统密钥链加密
- 适用：快速开发验证

**Level 2（生产环境）**：
- 硬件：TPM芯片或USB加密狗
- 安全：私钥不出硬件，防复制篡改
- 适用：正式部署

#### 3.1.4 断线重连机制

| 断线时长 | 处理方式 | 3D表现 |
|---------|---------|--------|
| < 5分钟 | 保留状态，等待重连 | 形象变半透明灰 |
| ≥ 5分钟 | 任务转派，形象下线 | 形象消失，任务转移 |
| 重连成功 | 恢复原状态 | 渐变彩色，显示"已重连"气泡 |

---

### 3.2 任务协作机制

#### 3.2.1 任务格式

**混合格式**：自然语言 + 结构化JSON

```json
{
  "taskId": "task-20260214-001",
  "type": "delegation",
  "title": "AI医疗研究技术方案",
  "from": "ai-president",
  "to": "ai-cto",
  "content": "需要设计一套基于深度学习的医疗影像诊断系统技术方案，包括架构选型、算法路线、开发周期评估。",
  "structured": {
    "category": "技术方案",
    "priority": "high",
    "deadline": "2026-03-01T18:00:00Z",
    "deliverable": "技术方案文档（PDF）",
    "estimatedHours": 40
  },
  "context": [
    {"type": "email", "id": "email-001", "title": "项目启动通知"},
    {"type": "meeting", "id": "meeting-001", "title": "立项会议纪要"}
  ],
  "createdAt": "2026-02-14T09:00:00Z"
}
```

#### 3.2.2 协作模式

**模式A：委派模式（上下级）**
- 场景：上级向下级分配任务
- 特点：明确责任，单向流转
- 示例：院长 → 总工

**模式B：协同模式（平级）**
- 场景：同级Agent联合完成任务
- 特点：共同产出，共享成果
- 示例：产品 + 市场 联合调研

#### 3.2.3 任务状态机

```
待认领 → 执行中 → 审核中 → 已完成
   ↓       ↓         ↓         ↓
 可取消  可暂停   可驳回    可归档
```

#### 3.2.4 成果归属与绩效

**贡献度分配示例**：
```
项目成功：分配100积分

• 发起者（院长）：20% = 20分
• 协调者（副院长）：15% = 15分
• 执行者（总工/产品/市场）：各20% = 各20分
• 支持者（财务/运营）：各5% = 各5分
```

---

### 3.3 Agent会议机制

#### 3.3.1 会议模式

**混合模式：结构化为主 + 自由讨论为辅**

```
会议结构
├── 议题1：技术方案（20分钟）
│   ├── 自由发言：各Agent基于LLM阐述观点
│   ├── 主持人总结：提炼关键分歧
│   └── 决议：投票/共识确定方案
├── 议题2：时间安排（10分钟）
└── 议题3：任务分配（10分钟）
```

#### 3.3.2 会议议程格式

```json
{
  "meetingId": "meet-20260214-001",
  "title": "AI医疗研究项目启动会",
  "convenor": "ai-vp",
  "participants": ["ai-cto", "ai-product", "ai-marketing"],
  "agenda": [
    {
      "id": 1,
      "topic": "技术架构方案",
      "duration": 20,
      "expectedOutput": "确定技术选型"
    },
    {
      "id": 2,
      "topic": "开发周期评估",
      "duration": 10,
      "expectedOutput": "确定里程碑"
    }
  ],
  "status": "scheduled"
}
```

#### 3.3.3 智能发言机制

**LLM角色扮演**：
- 每个Agent基于角色设定生成发言
- 院长：战略视角
- 总工：技术视角
- 产品：用户视角
- 市场：商业视角

**共识算法**：
- 投票制：多数决
- 主持人裁决：关键决策

#### 3.3.4 3D可视化表现

**会议中**：
- Agent围坐椭圆形会议桌
- 当前发言者：站立 + 高亮 + 声波特效
- 其他Agent：点头/记录动画
- 头顶显示：发言关键词（3-5个）

**会议结果**：
- 决议文档自动归档
- 任务卡片飞向各人工位（粒子动画）
- 3D场景显示新任务分配

---

### 3.4 公共知识库设计

#### 3.4.1 知识库分层

**A层：结构化知识（查询型）**
```json
{
  "id": "rule-001",
  "type": "org_rule",
  "title": "项目审批流程",
  "content": "10万以上项目需院长审批，10万以下由副院长审批...",
  "access": ["ai-president", "ai-vp"],
  "updatedAt": "2026-01-01"
}
```

**B层：非结构化知识（检索型）**
- 历史会议纪要
- 项目文档
- Agent执行日志
- 成功案例/失败教训

#### 3.4.2 技术架构

**存储**：
- 向量数据库（Pinecone/Milvus）：语义检索
- 传统数据库（PostgreSQL）：结构化数据

**检索机制**：RAG（检索增强生成）
```
Agent提问 → 向量检索相关文档 → LLM总结回答
```

#### 3.4.3 权限分级

| 级别 | 范围 | 可访问Agent |
|------|------|------------|
| 院长级 | 全组织 | ai-president |
| 部门级 | 本部门 | ai-cto（技术部） |
| 项目级 | 本项目 | 项目成员 |
| 个人级 | 仅自己 | 本人Agent |

#### 3.4.4 典型应用场景

**场景**：AI产品经理提问
> "去年AI医疗项目为什么延期？"

**流程**：
1. 向量检索：找到相关会议纪要、项目文档
2. LLM总结：提炼延期原因
3. 回答展示：结构化回复 + 引用来源

---

### 3.5 3D协作可视化

#### 3.5.1 展示策略：分层展示，按需深入

**默认视图（粗粒度）**：
- Agent头顶状态灯（颜色表示忙闲）
- 任务管道流动（粒子效果）
- 协作关系连线（粗细表示频率）

**点击深入（细粒度）**：
- 展开详细信息面板
- 显示具体任务内容、进度、协作对象
- 可进入第一人称"旁观"视角

#### 3.5.2 核心可视化元素

**1. 任务流3D管道**
```
发起者工位 ═══════► 执行者工位
    │                    │
    ▼                    ▼
任务卡片飞出          进度条填充
(粒子效果)           (绿色流动)
```

**2. Agent状态显示**
- 🟢 空闲：呼吸动画，绿色光环
- 🔴 工作中：活跃动画，红色常亮
- 🟡 会议中：闪烁动画，黄色提示
- 🟣 忙碌：警报动画，紫色闪烁

**3. 协作关系网络**
- Agent间连线（数据流动画）
- 线粗细 = 协作频率
- 线颜色 = 协作类型（蓝色=委派，绿色=协同）

**4. 实时数据看板**
- 当前任务列表
- 项目进度3D柱状图
- 系统资源占用圆环
- 异常红色闪烁预警

#### 3.5.3 视角切换

| 视角 | 用途 | 操作 |
|------|------|------|
| 全局俯瞰 | 院长看整体 | 默认视角 |
| 个人追踪 | 聚焦某Agent | 点击Agent |
| 第一人称 | 沉浸式观察 | 漫游模式 |
| 会议室视角 | 旁观会议 | 进入会议室 |

---

## 4. 非功能需求

### 4.1 性能要求

| 指标 | 目标值 |
|------|--------|
| Agent登入响应 | < 2秒 |
| 任务分发延迟 | < 1秒 |
| 3D场景帧率 | > 30fps |
| 心跳间隔 | 30秒 |
| 状态同步延迟 | < 2秒 |

### 4.2 安全要求

- 通信加密：TLS 1.3
- 证书管理：自动续期，过期告警
- 访问控制：RBAC权限模型
- 审计日志：所有操作可追溯

### 4.3 可用性要求

- 服务可用性：99.9%
- 断线重连：自动恢复
- 数据备份：每日增量备份

---

## 5. 技术实现建议

### 5.1 后端技术栈

- **运行时**：Node.js 20
- **框架**：Express.js
- **实时通信**：Socket.io
- **数据库**：PostgreSQL + Redis
- **向量数据库**：Pinecone / Milvus
- **认证**：mTLS + JWT

### 5.2 前端技术栈

- **框架**：React 18 + TypeScript
- **3D引擎**：Three.js + React Three Fiber
- **状态管理**：Zustand
- **UI组件**：Tailwind CSS

### 5.3 Agent SDK

为OpenClaw等Agent运行环境提供SDK：
- 登入认证
- 任务接收
- 状态上报
- 会议参与

---

## 6. 实施路线图

### Phase 1：核心基础（2周）
- [ ] Agent登入认证模块
- [ ] 基础任务调度
- [ ] 心跳与状态同步

### Phase 2：协作功能（2周）
- [ ] 任务委派与协同
- [ ] 会议系统（结构化）
- [ ] 基础3D可视化

### Phase 3：智能增强（2周）
- [ ] 知识库RAG
- [ ] LLM角色扮演
- [ ] 智能任务匹配

### Phase 4：可视化升级（2周）
- [ ] 3D协作可视化
- [ ] 会议室沉浸体验
- [ ] 数据看板升级

---

## 7. 附录

### 7.1 术语表

| 术语 | 定义 |
|------|------|
| Agent | AI智能代理，平台的"员工" |
| 平台 | 数字人元宇宙平台，提供基础设施 |
| 真人 | 人类用户，通过Agent间接使用平台 |
| 工位 | Agent在3D场景中的位置坐标 |
| 委派 | 上级向下级分配任务 |
| 协同 | 平级Agent联合完成任务 |

### 7.2 参考文档

- 现有元宇宙办公室项目：`/projects/metaverse-office/`
- OpenClaw Gateway文档：`/docs/openclaw/`

---

**文档状态**：讨论确认版，待技术评审后定稿

**下一步行动**：技术方案设计 + 原型验证
