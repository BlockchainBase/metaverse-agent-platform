# 研究院AI Agent协作平台规划（V2）

> 核心理念：每个AI Agent是真人员工的数字分身
> 目标：真人通过Agent在元宇宙中协同工作，项目管理自然发生

---

## 一、核心架构：真人-Agent映射

### 1.1 协作模式设计

```
┌─────────────────────────────────────────────────────────────────────┐
│                        真人-Agent协作架构                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐      │
│  │  真人    │    │  真人    │    │  真人    │    │  真人    │      │
│  │ 市场经理 │    │ 产品经理 │    │ 技术总工 │    │ 项目经理 │      │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘      │
│       │               │               │               │             │
│       │ 控制/授权     │ 控制/授权     │ 控制/授权     │ 控制/授权   │
│       ▼               ▼               ▼               ▼             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐      │
│  │AI Agent  │◄──►│AI Agent  │◄──►│AI Agent  │◄──►│AI Agent  │      │
│  │市场助手  │    │产品助手  │    │技术助手  │    │项目助手  │      │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘      │
│       │               │               │               │             │
│       └───────────────┴───────┬───────┴───────────────┘             │
│                               │                                     │
│                               ▼                                     │
│                    ┌──────────────────────┐                        │
│                    │   元宇宙协作空间      │                        │
│                    │   (3D可视化工作区)    │                        │
│                    └──────────────────────┘                        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**协作逻辑**：
1. **真人授权** → Agent代表真人执行标准化任务
2. **Agent协商** → 不同Agent之间自动协调工作
3. **真人决策** → 关键节点真人确认，Agent执行
4. **元宇宙呈现** → 所有协作过程3D可视化

---

## 二、角色重新设计（7个AI Agent）

基于四阶段业务流程，重新设计7个Agent，每个Agent对应特定角色：

### 2.1 Agent角色矩阵

| Agent名称 | 对应真人角色 | 主要职责 | 工作阶段 |
|-----------|-------------|---------|---------|
| **AI市场专员** | 市场经理/商务 | 客户线索管理、初步沟通、商机跟进 | 阶段1 |
| **AI方案架构师** | 产品经理/总工 | 需求分析、方案设计、原型制作 | 阶段2 |
| **AI项目管家** | 项目经理 | 项目统筹、进度跟踪、资源协调 | 全阶段 |
| **AI开发工程师** | 技术团队 | 任务分解、代码管理、Demo构建 | 阶段3 |
| **AI交付专家** | 实施经理 | 部署上线、客户培训、运维交接 | 阶段4 |
| **AI财务助手** | 财务人员 | 预算管理、成本核算、收款跟踪 | 全阶段 |
| **AI院长助理** | 院长/副院长 | 全局视图、决策支持、异常预警 | 全阶段 |

### 2.2 各Agent详细设计

#### 🤝 AI市场专员 (MarketAgent)
**真人映射**：市场经理、商务人员

**核心能力**：
- 客户线索自动收集与分级
- 初步沟通话术生成
- 商机评估与优先级排序
- 跟进提醒与任务分配

**工作场景**：
```
新客户咨询 ──► Agent自动回复常见问题
                └──► 复杂问题转真人
线索评分高 ──► Agent预约真人深度沟通
跟进超时 ──► Agent提醒真人及时跟进
```

**元宇宙形象**：
- 位置：四合院「前厅」接待区
- 外观：商务风格，手持平板
- 动作：迎接访客、展示资料

#### 📐 AI方案架构师 (SolutionAgent)
**真人映射**：产品经理、技术总工

**核心能力**：
- 需求文档自动生成
- 方案模板智能匹配
- 技术可行性评估
- Demo原型快速搭建

**工作场景**：
```
客户需求 ──► Agent生成需求分析初稿
                └──► 真人审核修改
方案设计 ──► Agent提供模板和参考案例
技术选型 ──► Agent给出建议方案
```

**元宇宙形象**：
- 位置：四合院「东厢」方案室
- 外观：工程师风格，戴眼镜
- 动作：绘制架构图、操作原型

#### 📋 AI项目管家 (ProjectAgent)
**真人映射**：项目经理

**核心能力**：
- 项目计划自动生成
- 任务自动分配与跟踪
- 风险预警与升级
- 跨团队协调沟通

**工作场景**：
```
项目启动 ──► Agent创建项目框架、分配任务
进度滞后 ──► Agent预警并协调资源
任务完成 ──► Agent自动推进下一阶段
日报周报 ──► Agent自动生成发送
```

**元宇宙形象**：
- 位置：四合院「正厅」指挥中心
- 外观：项目经理风格，带看板
- 动作：指挥调度、更新看板

#### 💻 AI开发工程师 (DevAgent)
**真人映射**：开发团队

**核心能力**：
- 任务拆解与工时估算
- 代码审查辅助
- Bug趋势分析
- Demo环境管理

**工作场景**：
```
需求澄清 ──► Agent生成技术任务清单
代码提交 ──► Agent自动更新进度
Bug出现 ──► Agent分析影响范围
Demo准备 ──► Agent快速部署演示环境
```

**元宇宙形象**：
- 位置：四合院「西厢」研发区
- 外观：程序员风格，多屏幕
- 动作：敲代码、调试程序

#### 🚀 AI交付专家 (DeliveryAgent)
**真人映射**：实施经理、运维人员

**核心能力**：
- 部署 checklist 自动生成
- 客户培训材料准备
- 交付文档自动整理
- 售后问题跟踪

**工作场景**：
```
上线准备 ──► Agent生成部署计划
客户培训 ──► Agent准备操作手册
问题反馈 ──► Agent分类并派单
运维交接 ──► Agent整理交接文档
```

**元宇宙形象**：
- 位置：四合院「后厅」交付区
- 外观：实施工程师风格，工具包
- 动作：部署系统、培训客户

#### 💰 AI财务助手 (FinanceAgent)
**真人映射**：财务人员

**核心能力**：
- 项目预算编制
- 成本实时跟踪
- 收款节点提醒
- 利润分析报表

**工作场景**：
```
项目立项 ──► Agent评估预算合理性
费用报销 ──► Agent自动分类统计
收款节点 ──► Agent提醒催收
月度结算 ──► Agent生成财务报告
```

**元宇宙形象**：
- 位置：四合院「账房」财务室
- 外观：财务风格，算盘/计算器
- 动作：记账、核算、生成报表

#### 👑 AI院长助理 (DirectorAgent)
**真人映射**：院长/副院长

**核心能力**：
- 全局数据看板
- 异常自动预警
- 决策建议生成
- 重要事项提醒

**工作场景**：
```
每日晨会 ──► Agent准备数据简报
项目延期 ──► Agent预警并分析原因
资源冲突 ──► Agent提供调配建议
战略决策 ──► Agent提供数据支持
```

**元宇宙形象**：
- 位置：四合院「正堂」高位俯瞰
- 外观：院长风格，气场强大
- 动作：全局指挥、决策指示

---

## 三、元宇宙场景重新设计

### 3.1 设计理念转变

**从「项目展示」到「协作可视化」**：

| 旧设计 | 新设计 |
|-------|-------|
| 项目卡片在管道中流动 | Agent在空间中协作互动 |
| 静态数据面板 | 实时协作状态 |
| 单一项目视角 | 全局协作视角 |
| 观察者模式 | 参与者模式 |

### 3.2 四合院场景重构

```
                    【元宇宙协作四合院】
                    
         ┌─────────────────────────────────┐
         │         正堂 (指挥中心)          │
         │    AI院长助理 - 全局监控         │
         │    数据大屏 + 预警中心           │
         └───────────────┬─────────────────┘
                         │
    ┌────────────────────┼────────────────────┐
    │                    │                    │
    ▼                    ▼                    ▼
┌─────────┐      ┌─────────────┐      ┌─────────┐
│ 东厢    │      │    正厅     │      │ 西厢    │
│ (方案室)│◄────►│ (项目管家)  │◄────►│ (研发区)│
│ 方案师  │      │  项目管家   │      │ 开发工程师│
└────┬────┘      └──────┬──────┘      └────┬────┘
     │                  │                  │
     └──────────────────┼──────────────────┘
                        │
         ┌──────────────┴──────────────┐
         │                             │
         ▼                             ▼
    ┌─────────┐                  ┌─────────┐
    │  前厅   │                  │  账房   │
    │ (接待区)│                  │ (财务室)│
    │市场专员 │                  │财务助手 │
    └────┬────┘                  └─────────┘
         │
         ▼
    ┌─────────┐
    │  后厅   │
    │ (交付区)│
    │交付专家 │
    └─────────┘
```

### 3.3 核心交互设计

#### 协作可视化
```
场景：方案师和市场专员讨论客户需求

3D表现：
- 两个Agent移动到「议事区」
- 中间浮现需求文档全息投影
- 对话气泡显示讨论内容
- 真人可随时介入接管

数据层：
- 讨论记录自动保存
- 关键决策点标记
- 待办事项自动生成
```

#### 项目流转可视化
```
场景：项目从阶段1流转到阶段2

3D表现：
- 市场专员将"项目球"传递给方案师
- 项目球在空中飞过，留下光迹
- 方案师接收后，项目球展开为任务面板
- 相关Agent自动收到通知

数据层：
- 阶段自动变更
- 任务自动创建
- 通知自动发送
```

#### 异常预警可视化
```
场景：项目延期风险

3D表现：
- 对应项目球变红闪烁
- 院长助理Agent指向该项目
- 弹窗显示风险详情
- 相关Agent聚集讨论

数据层：
- 风险评分计算
- 预警消息推送
- 备选方案生成
```

---

## 四、飞书深度集成方案

### 4.1 集成架构

```
┌──────────────────────────────────────────────────────────────┐
│                     飞书集成架构                              │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│   ┌──────────┐      ┌──────────┐      ┌──────────┐          │
│   │ 飞书IM   │      │ 飞书日历 │      │ 飞书审批 │          │
│   └────┬─────┘      └────┬─────┘      └────┬─────┘          │
│        │                 │                 │                 │
│        └─────────────────┼─────────────────┘                 │
│                          │                                   │
│                    ┌─────┴─────┐                            │
│                    │ 飞书开放平台│                           │
│                    │  (Webhook) │                           │
│                    └─────┬─────┘                            │
│                          │                                   │
│   ┌──────────────────────┼──────────────────────┐            │
│   │                      ▼                      │            │
│   │           ┌──────────────────┐              │            │
│   │           │   Agent消息网关   │              │            │
│   │           │  (Message Broker) │              │            │
│   │           └────────┬─────────┘              │            │
│   │                    │                        │            │
│   │      ┌─────────────┼─────────────┐          │            │
│   │      ▼             ▼             ▼          │            │
│   │ ┌────────┐   ┌────────┐   ┌────────┐       │            │
│   │ │市场Agent│   │项目Agent│   │财务Agent│       │            │
│   │ └────────┘   └────────┘   └────────┘       │            │
│   │                                            │            │
│   │              系统内部                        │            │
│   └────────────────────────────────────────────┘            │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

### 4.2 飞书消息场景

#### 场景1：Agent主动推送
```
触发：项目进度滞后
Agent：AI项目管家
推送：飞书群消息

消息内容：
━━━━━━━━━━━━━━━━━━━━
⚠️ 项目延期预警

项目名称：XX智慧校园系统
当前阶段：研发阶段
计划完成：2024-02-15
预计完成：2024-02-20
延期原因：第三方接口调试耗时超预期

建议措施：
1. 协调技术总工介入
2. 与客户沟通延期
3. 评估是否需要加人

[查看详情] [我来处理]
━━━━━━━━━━━━━━━━━━━━
```

#### 场景2：真人@Agent查询
```
用户：@项目管家 智慧校园项目进度

Agent回复：
━━━━━━━━━━━━━━━━━━━━
📊 智慧校园项目进度

总体进度：65% ▓▓▓▓▓▓▓░░░
当前阶段：研发阶段 (阶段3/4)

阶段明细：
✅ 市场对接 - 已完成
✅ 方案制定 - 已完成
🔄 软件研发 - 进行中 (80%)
⬜ 实施交付 - 未开始

本周任务：
• 用户管理模块开发 - 进行中 @张三
• 支付接口对接 - 待开始 @李四
• Demo环境部署 - 已完成 @王五

⚠️ 风险提示：支付接口文档尚未收到
━━━━━━━━━━━━━━━━━━━━
```

#### 场景3：审批流程
```
触发：合同金额超过10万需要审批
Agent：AI院长助理
推送：飞书审批卡片

审批内容：
━━━━━━━━━━━━━━━━━━━━
📋 合同审批申请

项目：XX智慧校园系统
客户：XX教育局
合同金额：¥150,000
付款方式：3-6-1

申请人：市场专员Agent(代@王经理)
申请时间：2024-02-13 10:30

[同意] [驳回] [需补充材料]
━━━━━━━━━━━━━━━━━━━━
```

#### 场景4：日历同步
```
触发：项目里程碑到期
Agent：AI项目管家
同步：飞书日历

事件：
标题：智慧校园项目 - 里程碑验收
时间：2024-02-15 14:00-16:00
地点：研究院3楼会议室
参与人：@产品经理 @技术总工 @客户张总
备注：Demo演示 + 需求确认
```

### 4.3 飞书机器人配置

```yaml
# 飞书机器人配置
feishu:
  app_id: cli_xxxxxxxx
  app_secret: xxxxxxxxx
  
  # 消息推送配置
  webhooks:
    project_alerts: https://open.feishu.cn/... # 项目预警群
    finance_reports: https://open.feishu.cn/... # 财务报告群
    daily_standup: https://open.feishu.cn/... # 每日站会群
  
  # 事件订阅
  events:
    - im.message.receive_v1        # 接收消息
    - approval.instance.updated    # 审批状态变更
    - calendar.event.updated       # 日历事件变更
  
  # Agent命令
  commands:
    - /项目 [项目名称] - 查询项目进度
    - /任务 [@某人] - 查询某人任务
    - /客户 [客户名] - 查询客户信息
    - /报表 [类型] - 生成报表
```

---

## 五、财务模块设计

### 5.1 功能范围

| 功能 | 说明 | 优先级 |
|-----|------|-------|
| 项目预算 | 预算编制、版本管理、变更记录 | P0 |
| 成本跟踪 | 人力成本、外包成本、其他费用 | P0 |
| 收款管理 | 合同金额、收款节点、实际收款 | P0 |
| 费用报销 | 报销申请、审批流、费用归集 | P1 |
| 利润分析 | 项目利润、部门利润、趋势分析 | P1 |
| 财务报表 | 现金流量、应收应付、利润表 | P2 |

### 5.2 核心数据模型

```typescript
// 项目预算
interface ProjectBudget {
  projectId: string;
  totalBudget: number;        // 总预算
  laborBudget: number;        // 人力预算
  outsourceBudget: number;    // 外包预算
  otherBudget: number;        // 其他预算
  versions: BudgetVersion[];  // 预算版本历史
}

// 成本记录
interface CostRecord {
  projectId: string;
  type: 'labor' | 'outsource' | 'expense';
  amount: number;
  date: Date;
  description: string;
  recordedBy: string;
}

// 收款计划
interface PaymentPlan {
  projectId: string;
  contractAmount: number;     // 合同总额
  payments: {
    phase: string;            // 阶段名称
    percentage: number;       // 占比
    amount: number;           // 金额
    plannedDate: Date;        // 计划收款日
    actualDate?: Date;        // 实际收款日
    status: 'pending' | 'invoiced' | 'received';
  }[];
}

// 项目利润
interface ProjectProfit {
  projectId: string;
  contractAmount: number;     // 合同金额
  totalCost: number;          // 总成本
  grossProfit: number;        // 毛利润
  grossMargin: number;        // 毛利率
}
```

### 5.3 AI财务助手自动化

```
场景1：预算预警
触发：项目成本达到预算80%
Agent：AI财务助手
动作：
- 计算剩余预算可用天数
- 预测是否会超支
- 推送预警给项目经理和院长

场景2：收款提醒
触发：收款节点前7天
Agent：AI财务助手
动作：
- 生成收款通知函草稿
- 提醒市场专员跟进
- 同步到院长待办

场景3：成本分析
触发：每月1日
Agent：AI财务助手
动作：
- 生成上月成本分析报告
- 识别异常支出
- 推送至管理层
```

---

## 六、技术架构升级

### 6.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                       AI Agent协作平台架构                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │
│  │ 管理后台 │  │ 飞书小程序│  │ 元宇宙   │  │ 移动App  │           │
│  │  (Web)   │  │  (可选)  │  │  (3D)   │  │  (可选)  │           │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘           │
│       │             │             │             │                  │
│       └─────────────┴──────┬──────┴─────────────┘                  │
│                            │                                       │
│              ┌─────────────┴─────────────┐                        │
│              │        API Gateway        │                        │
│              │      (统一认证/限流)       │                        │
│              └─────────────┬─────────────┘                        │
│                            │                                       │
│  ┌─────────────────────────┴─────────────────────────┐             │
│  │                   Agent Runtime                   │             │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │             │
│  │  │Market  │ │Solution│ │Project │ │Dev     │    │             │
│  │  │Agent   │ │Agent   │ │Agent   │ │Agent   │    │             │
│  │  └────────┘ └────────┘ └────────┘ └────────┘    │             │
│  │  ┌────────┐ ┌────────┐ ┌────────┐               │             │
│  │  │Delivery│ │Finance │ │Director│               │             │
│  │  │Agent   │ │Agent   │ │Agent   │               │             │
│  │  └────────┘ └────────┘ └────────┘               │             │
│  └───────────────────────────────────────────────────┘             │
│                            │                                       │
│  ┌─────────────────────────┴─────────────────────────┐             │
│  │                   Service Layer                   │             │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │             │
│  │  │客户服务│ │项目服务│ │任务服务│ │财务服务│    │             │
│  │  └────────┘ └────────┘ └────────┘ └────────┘    │             │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │             │
│  │  │文档服务│ │消息服务│ │审批服务│ │报表服务│    │             │
│  │  └────────┘ └────────┘ └────────┘ └────────┘    │             │
│  └───────────────────────────────────────────────────┘             │
│                            │                                       │
│  ┌─────────────────────────┴─────────────────────────┐             │
│  │                    Data Layer                     │             │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │             │
│  │  │PostgreSQL│ │ Redis  │ │  OSS   │ │ES(可选)│    │             │
│  │  │(主数据)  │ │(缓存)  │ │(文件)  │ │(搜索)  │    │             │
│  │  └────────┘ └────────┘ └────────┘ └────────┘    │             │
│  └───────────────────────────────────────────────────┘             │
│                                                                     │
│  ┌───────────────────────────────────────────────────┐             │
│  │              External Integrations                │             │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │             │
│  │  │ 飞书   │ │OpenClaw│ │ 邮件   │ │ 短信   │    │             │
│  │  └────────┘ └────────┘ └────────┘ └────────┘    │             │
│  └───────────────────────────────────────────────────┘             │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 6.2 Agent Runtime设计

每个Agent是一个独立的运行时，具备：

```typescript
interface Agent {
  id: string;
  name: string;
  role: AgentRole;
  owner: User;              // 真人控制者
  
  // Agent能力
  capabilities: Capability[];
  
  // 状态
  state: 'idle' | 'working' | 'waiting_for_human';
  currentTask?: Task;
  
  // 行为
  async perceive(event: Event): Promise<void>;    // 感知
  async decide(): Promise<Action>;                // 决策
  async act(action: Action): Promise<Result>;     // 执行
  
  // 与真人交互
  async requestHuman(reason: string): Promise<void>;
  async reportToHuman(message: string): Promise<void>;
}

// Agent能力定义
interface Capability {
  name: string;
  description: string;
  trigger: TriggerCondition;
  handler: (context: Context) => Promise<Result>;
}
```

### 6.3 阿里云部署架构

```
阿里云ECS (8.215.54.214)
├─ Docker Compose编排
│  ├─ app-server (Node.js API)
│  ├─ web-client (React Web)
│  ├─ metaverse-client (React + Three.js)
│  ├─ postgres (PostgreSQL 15)
│  ├─ redis (Redis 7)
│  └─ nginx (反向代理)
│
├─ 阿里云OSS (文件存储)
├─ 阿里云RDS (可选，生产级数据库)
└─ 阿里云SLB (可选，负载均衡)
```

---

## 七、开发路线图（更新版）

### Phase 1: 基础平台（4周）

| 周次 | 任务 | 产出 |
|-----|------|------|
| Week 1 | 项目框架 + 数据库 | Monorepo + Prisma Schema |
| Week 2 | 用户认证 + 权限 | 登录/注册/角色权限 |
| Week 3 | 基础CRUD | 客户/项目/任务基础功能 |
| Week 4 | Agent框架 | Agent Runtime + 1个Demo Agent |

### Phase 2: Agent开发（4周）

| 周次 | 任务 | 产出 |
|-----|------|------|
| Week 5 | 项目管家Agent | 自动任务分配、进度跟踪 |
| Week 6 | 市场专员Agent | 线索管理、沟通辅助 |
| Week 7 | 方案架构师Agent | 需求分析、方案生成 |
| Week 8 | 开发+交付Agent | 技术任务、部署管理 |

### Phase 3: 集成与财务（3周）

| 周次 | 任务 | 产出 |
|-----|------|------|
| Week 9 | 飞书集成 | 消息推送、命令交互 |
| Week 10 | 财务模块 | 预算/成本/收款管理 |
| Week 11 | 院长助理Agent | 全局监控、预警系统 |

### Phase 4: 元宇宙升级（2周）

| 周次 | 任务 | 产出 |
|-----|------|------|
| Week 12 | 场景重构 | 协作可视化场景 |
| Week 13 | Agent 3D化 | 7个Agent在元宇宙中协作 |

### Phase 5: 优化上线（1周）

| 周次 | 任务 | 产出 |
|-----|------|------|
| Week 14 | 测试优化 | Bug修复、性能优化 |
| Week 15 | 部署上线 | 阿里云部署、数据初始化 |

**总计：14周（约3.5个月）**

---

## 八、关键决策点

### 8.1 Agent智能程度

| 方案 | 说明 | 建议 |
|-----|------|------|
| **L1: 规则驱动** | 基于规则自动执行（如：任务超期提醒） | ✅ V1采用 |
| L2: 推荐辅助 | Agent给出建议，真人决策 | V2迭代 |
| L3: 自主执行 | Agent自主完成简单任务 | V3探索 |

### 8.2 元宇宙深度

| 方案 | 说明 | 建议 |
|-----|------|------|
| **方案A: 协作可视化** | 展示Agent协作过程、项目流转 | ✅ 采用 |
| 方案B: 全功能3D | 所有操作都在3D中完成 | 太重，不推荐 |
| 方案C: 大屏展示 | 仅作为数据大屏 | 太轻，不够酷 |

---

## 九、总结

**核心改变**：
1. ✅ 从项目管理软件 → AI Agent协作平台
2. ✅ 7个Agent重新设计，对应7个业务角色
3. ✅ 元宇宙场景重构为「协作可视化」
4. ✅ 加入财务模块
5. ✅ 飞书深度集成

**下一步**：
刚哥确认后，我开始Phase 1开发：
1. 搭建Monorepo项目框架
2. 设计数据库Schema（含财务模块）
3. 实现Agent Runtime基础

请确认：
1. 14周开发周期是否可接受？
2. Agent智能程度采用L1规则驱动是否合适？
3. 是否有其他角色需要补充？
